import{h as t,r as e,H as i,g as s}from"./p-123acab3.js";import{T as n}from"./p-2ae534e4.js";const h=({draggingState:e,size:i})=>{if(!e)return null;const{width:s,translation:h,dragContent:r,validTarget:o,targetId:l}=e,a={width:s,transform:`translate(calc(${h.x}px - 10%), calc(${h.y}px - 50%))`,msTransform:`translateX(${h.x}px) translateX(-10%) translateY(${h.y}px) translateY(-50%)`},d=`drag-content${l&&!o?" drop-block":" drop-allow"} ${n.get(i||"standard")}`;return t("div",{style:Object.assign({},a),ref:t=>t&&t.appendChild(r),class:d})};const r=class{constructor(t){e(this,t),this.items={},this.syncItems=[],this.onMouseMove=t=>this.handleItemDragOver(t),this.onMouseUp=()=>this.handleItemDrop(),this.INITIAL_DRAG_POSITION={x:0,y:0},this.checkboxSelection=void 0,this.checkedItems=[],this.disableTabbing=void 0,this.expandedItems=[],this.multiCheckboxSelection=void 0,this.multiSelection=void 0,this.selectedItems=[],this.size="standard",this.itemDragState=void 0}clearItemDropState(){if(!this.itemDragState)return null;const t=this.itemDragState,{targetId:e}=t,i=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(i[s[n]]=t[s[n]])}return i}(t,["targetId"]);return e&&(this.items[e].content.classList.remove("drop-allow"),this.items[e].content.classList.remove("drop-block")),Object.assign(Object.assign({},i),{targetId:null,validTarget:null})}handleDocumentClick(t){this.element.contains(t.target)||t.defaultPrevented||(this.focusItem=null)}handleItemDragState(t,e){e&&t&&e.itemId===t.itemId||(t?(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)))}handleItemDragStart(t,e,i){const{clientX:s,clientY:n,currentTarget:h}=i,r=null==h?void 0:h.parentElement,o={x:s,y:n};this.clearItemDropState(),this.itemDragState={dragContent:e,origin:o,translation:o,itemId:t,width:`${null==r?void 0:r.offsetWidth}px`,height:`${null==r?void 0:r.offsetHeight}px`}}handleItemDragOver(t){if(!this.itemDragState)return;const{clientX:e,clientY:i}=t,s={x:e,y:i},{nodeId:n,element:h,content:r}=this.getItemWithinBounds(e,i)||{};let o=Object.assign(Object.assign({},this.clearItemDropState()),{translation:s});if(n&&n!==o.itemId){const t=this.getParentIds(n);o=Object.assign(Object.assign({},o),{targetId:n}),!h.droppableItem||this.isItemDisabled(n)||t&&t.includes(o.itemId)?(o.validTarget=!1,r.classList.add("drop-block")):(o.validTarget=!0,r.classList.add("drop-allow"))}this.itemDragState=Object.assign({},o)}handleItemDrop(){var t;if(!this.itemDragState)return;const{itemId:e,targetId:i,validTarget:s}=this.itemDragState;if(e&&s&&e!==i){const{parentId:e,element:s}=this.items[i];s&&((null===(t=this.items[e])||void 0===t?void 0:t.element)||this.element).insertBefore(this.items[this.itemDragState.itemId].element,s)}this.clearItemDropState(),this.itemDragState=null}handleItemsProps(t,e){this.syncItems.push(...e||[],...t||[])}handleOptionsProps(){const t=this.getTreeViewItemOptions();Object.values(this.items).forEach((({element:e})=>{e.initTreeViewItem(t)}))}handleTreeSlotChange(){Array.from(this.element.children).map((t=>t.nodeId)).filter((t=>t)).forEach(((t,e)=>{this.updateItem({nodeId:t,index:e,parentId:null})}))}getItemWithinBounds(t,e){return Object.values(this.items).find((({content:i})=>{const s=null==i?void 0:i.getBoundingClientRect();return!!s&&(e>=s.top&&e<=s.bottom&&t>=s.left&&t<=s.right)}))}getParentIds(t){if(!t)return[];const{parentId:e}=this.items[t];return e?[e,...this.getParentIds(e)]:[]}addItem(t){const e=t,i=t.parentNode;if(e.nodeId){const{children:t,nodeId:s}=i,n=Array.from(t).filter((t=>t.nodeId)).indexOf(e),h=this.getLevel(s)+1;this.items[e.nodeId]=Object.assign(Object.assign({},this.items[e.nodeId]),{nodeId:e.nodeId,index:n,element:e,disabled:e.disabled,parentId:s,level:h}),e.initTreeViewItem(this.getTreeViewItemOptions())}}componentDidUpdate(){var t;null===(t=this.syncItems)||void 0===t||t.forEach((t=>this.syncTreeViewItem(t))),this.syncItems=[]}deleteItem(t){const e=this.items[t];let i=[];if(e){e.children.forEach((t=>{delete this.items[t],i.push(t)})),delete this.items[t],i.push(t);const s=t=>t.find((t=>i.includes(t)))?t.filter((t=>!i.includes(t))):t;this.checkedItems=s(this.checkedItems),this.selectedItems=s(this.selectedItems),this.expandedItems=s(this.expandedItems),i.includes(this.focusItem)&&(this.focusItem=null)}}getChildrenIds(t,e=!0){var i;const s=null===(i=this.items[t])||void 0===i?void 0:i.children;return s?Array.from(s).map((t=>this.items[t])).sort(((t,e)=>t.index-e.index)).reduce(((t,i)=>(t.push(i.nodeId,...e?this.getChildrenIds(i.nodeId,e):[]),t)),[]):[]}getLevel(t){var e;return(null===(e=this.items[t])||void 0===e?void 0:e.level)||0}getFirstItem(){const t=this.element.firstElementChild;return t?t.nodeId:null}getLastItem(){const t=this.element.lastElementChild;if(t){const e=t;let i=e.nodeId;return this.isItemExpanded(e.nodeId)&&(i=this.getChildrenIds(e.nodeId,!0).slice(-1)[0]),i}return null}getNavigableChildrenIds(t){let e=[];return e=t?this.getChildrenIds(t,!1):Object.values(this.items).filter((t=>!t.parentId)).sort(((t,e)=>t.index-e.index)).map((t=>t.nodeId)),e.filter((t=>!this.isItemDisabled(t)))}getNextNavigableItem(t){if(this.isItemExpanded(t)){const e=this.getNavigableChildrenIds(t);if(e.length)return e[0]}let e=this.items[t];for(;null!=e;){const t=this.getNavigableChildrenIds(e.parentId),i=t[t.indexOf(e.nodeId)+1];if(i)return i;e=this.items[e.parentId]}return t}getPrevNavigableItem(t){const e=this.items[t],i=this.getNavigableChildrenIds(e.parentId),s=i.indexOf(t);if(0===s)return e.parentId||t;let n=i[s-1];for(;this.isItemExpanded(n)&&this.getNavigableChildrenIds(n).length>0;)n=this.getNavigableChildrenIds(n).pop();return n}getTreeViewItemOptions(){return{multiSelection:this.multiSelection,checkboxSelection:this.checkboxSelection,multiCheckboxSelection:this.multiCheckboxSelection,size:this.size,disableTabbing:this.disableTabbing,getLevel:t=>this.getLevel(t),hasItemFocus:t=>this.isItemInFocus(t),hasItemSelected:t=>this.isItemSelected(t),hasItemDisabled:t=>this.isItemDisabled(t),hasItemExpanded:t=>this.isItemExpanded(t),hasItemChecked:t=>this.isItemChecked(t),hasItemIndeterminate:t=>this.isItemIndeterminate(t),showSelectionIndicator:t=>this.showSelectionIndicator(t),onItemSelection:(t,e)=>this.handleItemSelection(t,e),onCheckboxSelection:(t,e)=>this.handleCheckboxSelection(t,e),onItemExpandToggle:t=>this.handleItemExpand(t),onItemFocus:t=>this.handleItemFocus(t),onItemAdd:t=>this.addItem(t),onItemDelete:t=>this.deleteItem(t),onItemUpdate:(t,e)=>this.updateItem(t,e),onItemDrag:(t,e,i)=>this.handleItemDragStart(t,e,i)}}handleCheckboxSelection(t,e=!1){if(this.items[t].disabled)return;let i=!this.isItemChecked(t),s=[...this.checkedItems],n=[...this.checkedItems,t];if(this.multiCheckboxSelection){if(e){const e=this.getChildrenIds(t,!1);i=e.filter((t=>s.includes(t))).length===e.length,i?s.push(t):s=s.filter((e=>e!==t))}else{const e=this.getChildrenIds(t,!0);i?s.push(t,...e):s=s.filter((e=>e!==t)).filter((t=>!e.includes(t))),n.push(...e)}const h=this.getParentIds(t);h.forEach((t=>{const e=this.getChildrenIds(t,!1);e.filter((t=>s.includes(t))).length===e.length?s.push(t):s=s.filter((e=>e!==t))})),n.push(...h)}else s=i?[t]:[];this.checkedItems=[...s],this.syncItems.push(...n,...s)}handleItemAdded(t){this.addItem(t.detail),t.preventDefault(),t.stopPropagation()}handleItemExpand(t){const{children:e}=this.items[t];if(!e||!e.length)return;const i=!this.isItemExpanded(t);let s=[...this.expandedItems];i?s.push(t):s=s.filter((e=>e!==t)),this.expandedItems=[...s],this.syncItems.push(t)}handleItemFocus(t){const{element:e}=this.items[t];this.focusItem=t,e.focusItem()}handleItemSelection(t,e){if(this.items[t].disabled)return;const i=this.multiSelection&&e&&(e.shiftKey||e.ctrlKey||e.metaKey),s=!this.isItemSelected(t),n=[...this.selectedItems];let h=[...this.selectedItems];s?i?h.push(t):h=[t]:h=h.filter((e=>e!==t)),this.selectedItems=[...h],this.syncItems.push(...n,...h)}handleKeyDown(t){if(t.defaultPrevented||t.altKey)return;let e=!1;switch(t.code.toUpperCase()){case"SPACE":this.focusItem&&(this.handleItemExpand(this.focusItem),e=!0);break;case"ENTER":this.focusItem&&(this.handleItemSelection(this.focusItem,t),t.stopPropagation());break;case"ARROWDOWN":const i=this.focusItem?this.getNextNavigableItem(this.focusItem):this.getFirstItem();this.multiSelection&&t.shiftKey&&this.isItemSelected(this.focusItem)&&(this.isItemSelected(i)?this.handleItemSelection(this.focusItem,t):this.handleItemSelection(i,t)),this.handleItemFocus(i),e=!0;break;case"ARROWUP":const s=this.focusItem?this.getPrevNavigableItem(this.focusItem):this.getLastItem();this.multiSelection&&t.shiftKey&&this.isItemSelected(this.focusItem)&&(this.isItemSelected(s)?this.handleItemSelection(this.focusItem,t):this.handleItemSelection(s,t)),this.handleItemFocus(s),e=!0;break;case"ARROWRIGHT":if(this.focusItem)if(this.disableTabbing&&t.shiftKey){const{element:t}=this.items[this.focusItem];t.focusCheckbox()}else this.isItemExpanded(this.focusItem)||this.handleItemExpand(this.focusItem);break;case"ARROWLEFT":this.focusItem&&this.isItemExpanded(this.focusItem)&&this.handleItemExpand(this.focusItem);break;case"TAB":this.disableTabbing&&this.resetFocusItem()}e&&(t.preventDefault(),t.stopPropagation())}isItemChecked(t){return this.checkedItems.includes(t)}isItemExpanded(t){return this.expandedItems.includes(t)}isItemInFocus(t){return this.focusItem===t}isItemSelected(t){return this.selectedItems.includes(t)}isItemIndeterminate(t){const e=this.getChildrenIds(t);if(e&&this.multiCheckboxSelection){const t=e.filter((t=>this.isItemChecked(t)));return t.length>0&&t.length<e.length}return!1}isItemDisabled(t){const{disabled:e}=this.items[t],i=this.getParentIds(t);return e||Boolean(null==i?void 0:i.find((t=>this.items[t].disabled)))}resetFocusItem(){this.focusItem=null}showSelectionIndicator(t){return this.isItemSelected(t)||!this.isItemExpanded(t)&&Boolean(this.getChildrenIds(t,!0).find((t=>this.isItemSelected(t))))}syncTreeViewItem(t){var e,i;null===(i=null===(e=this.items[t])||void 0===e?void 0:e.element)||void 0===i||i.updateComponent()}updateItem(t,e){var i;let s;e&&t.nodeId!==e.nodeId?(s=Object.assign({},this.items[e.nodeId]),delete this.items[e.nodeId]):s=Object.assign({},this.items[t.nodeId]),s.nodeId?(this.items[t.nodeId]=Object.assign(Object.assign({},s),t),null===(i=t.children)||void 0===i||i.forEach((e=>{this.items[e]=Object.assign(Object.assign({},this.items[e]),{parentId:t.nodeId})}))):this.items[t.nodeId]=Object.assign({},t)}render(){return t(i,null,t("ul",{role:"tree",tabindex:this.disableTabbing?0:null,onKeyDown:t=>this.handleKeyDown(t)},t("slot",{onSlotchange:()=>this.handleTreeSlotChange()})),t(h,{draggingState:this.itemDragState}))}get element(){return s(this)}static get watchers(){return{itemDragState:["handleItemDragState"],expandedItems:["handleItemsProps"],selectedItems:["handleItemsProps"],checkedItems:["handleItemsProps"],checkboxSelection:["handleOptionsProps"],disableTabbing:["handleOptionsProps"],multiCheckboxSelection:["handleOptionsProps"],multiSelection:["handleOptionsProps"],size:["handleOptionsProps"]}}};r.style='@import url("https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700");.drag-content{cursor:grabbing !important;left:0;opacity:0.9;position:fixed;top:0;z-index:99999}.drag-content .tree-item{align-items:center;background-color:var(--modus-tree-view-item-bg, #fff);border:0.0625rem solid var(--modus-tree-view-item-border-color, #e0e1e9);color:var(--modus-tree-view-item-color, #252a2e);display:flex;font-family:"Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-size:1rem;height:2.375rem;width:100%}.drag-content .tree-item .icon-slot{visibility:hidden}.drag-content .tree-item.large{height:2.875rem}.drag-content .tree-item.small{font-size:0.75rem;height:1.875rem}.drag-content.drop-allow .tree-item{border:2px dashed var(--modus-tree-view-item-drag-border-color, #217cbb) !important}.drag-content.drop-block .tree-item{border:2px dashed var(--modus-tree-view-item-drag-error-border-color, #da212c) !important}:host{display:block}ul{padding:0}';export{r as modus_tree_view}