{"version":3,"file":"ContextMenu.js","sources":["../../src/Examples/ContextMenu.ts"],"sourcesContent":["import { PickEventDetail, WebglViewerEventName } from \"../common\";\nimport { WebglViewer } from \"../WebglViewer\";\nimport { SelectionTool } from \"../Tools/SelectionTool\";\nimport { PickingTool } from \"../Tools/PickingTool\";\nimport {Key} from \"ts-key-enum\";\n\nexport class ContextMenu {\n    private selectionTool: SelectionTool;\n\n    constructor(protected element: HTMLElement, protected viewer: WebglViewer) {\n        this.selectionTool = this.viewer.tools.get(SelectionTool);\n        this.viewer.tools.get(PickingTool).enabled = true;\n        this.viewer.addEventListener(WebglViewerEventName.Pick, e => this.onPick(e as CustomEvent<PickEventDetail>));\n        this.viewer.addEventListener(WebglViewerEventName.NavigationStart, () => this.hide());\n        this.viewer.addEventListener(WebglViewerEventName.DragStart, () => this.hide());\n        document.addEventListener(\"keydown\", (e) => {\n            if (e.code === Key.Escape) this.hide();\n        });\n    }\n\n    protected initContent(eventDetail: PickEventDetail): void {\n        this.element.textContent = eventDetail.modelId + \" : \" + eventDetail.id;\n    }\n\n    protected show(eventDetail: PickEventDetail, element: HTMLElement): void {\n        element.style.display = \"flex\";\n        element.style.left = (eventDetail.screenPosition.x - element.clientWidth / 2) + \"px\";\n        element.style.top = (eventDetail.screenPosition.y - element.clientHeight - 50) + \"px\";\n\n        // prevent deselection when user clicks elsewhere to close context menu\n        this.switchSelectionTool(false);\n    }\n\n    protected isShown(): boolean {\n        return this.element.style.display !== \"none\";\n    }\n\n    protected hide(): void {\n        if (this.isShown()) {\n            this.element.style.display = \"none\";\n            this.switchSelectionTool(true);\n        }\n    }\n\n    protected switchSelectionTool(enabled: boolean): void {\n        setTimeout(() => (this.selectionTool.enabled = enabled), 0);\n    }\n\n    protected onPick(e: CustomEvent<PickEventDetail>): void {\n        if (e.detail.modelId && !this.isShown()) {\n            if (this.selectionTool.enabled) {\n                this.initContent(e.detail);\n                this.show(e.detail, this.element);\n            }\n        }\n        else\n            this.hide();\n    }\n}\n"],"names":["[object Object]","element","viewer","this","selectionTool","tools","get","SelectionTool","PickingTool","enabled","addEventListener","e","onPick","hide","document","code","eventDetail","textContent","modelId","id","style","display","left","screenPosition","x","clientWidth","top","y","clientHeight","switchSelectionTool","isShown","setTimeout","detail","initContent","show"],"mappings":"kGASIA,YAAsBC,EAAgCC,GAAhCC,aAAAF,EAAgCE,YAAAD,EAClDC,KAAKC,cAAgBD,KAAKD,OAAOG,MAAMC,IAAIC,iBAC3CJ,KAAKD,OAAOG,MAAMC,IAAIE,eAAaC,SAAU,EAC7CN,KAAKD,OAAOQ,yBAA4CC,GAAKR,KAAKS,OAAOD,KACzER,KAAKD,OAAOQ,oCAAuD,IAAMP,KAAKU,SAC9EV,KAAKD,OAAOQ,8BAAiD,IAAMP,KAAKU,SACxEC,SAASJ,iBAAiB,WAAYC,eAC9BA,EAAEI,MAAqBZ,KAAKU,UAI9Bb,YAAYgB,GAClBb,KAAKF,QAAQgB,YAAcD,EAAYE,QAAU,MAAQF,EAAYG,GAG/DnB,KAAKgB,EAA8Bf,GACzCA,EAAQmB,MAAMC,QAAU,OACxBpB,EAAQmB,MAAME,KAAQN,EAAYO,eAAeC,EAAIvB,EAAQwB,YAAc,EAAK,KAChFxB,EAAQmB,MAAMM,IAAOV,EAAYO,eAAeI,EAAI1B,EAAQ2B,aAAe,GAAM,KAGjFzB,KAAK0B,qBAAoB,GAGnB7B,UACN,MAAsC,SAA/BG,KAAKF,QAAQmB,MAAMC,QAGpBrB,OACFG,KAAK2B,YACL3B,KAAKF,QAAQmB,MAAMC,QAAU,OAC7BlB,KAAK0B,qBAAoB,IAIvB7B,oBAAoBS,GAC1BsB,YAAW,IAAO5B,KAAKC,cAAcK,QAAUA,GAAU,GAGnDT,OAAOW,GACTA,EAAEqB,OAAOd,UAAYf,KAAK2B,UACtB3B,KAAKC,cAAcK,UACnBN,KAAK8B,YAAYtB,EAAEqB,QACnB7B,KAAK+B,KAAKvB,EAAEqB,OAAQ7B,KAAKF,UAI7BE,KAAKU"}